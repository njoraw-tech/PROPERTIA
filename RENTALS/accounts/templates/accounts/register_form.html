<form method="POST" id="registerForm">
    {% csrf_token %}
    <input type="hidden" name="next" value="{{ request.GET.next }}">
    
    {% if form.non_field_errors or form.errors %}
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <h5 class="alert-heading">Please fix the following errors:</h5>
            <ul class="mb-0">
                {% for error in form.non_field_errors %}
                    <li>{{ error }}</li>
                {% endfor %}
                {% for field in form %}
                    {% for error in field.errors %}
                        <li><strong>{{ field.label }}:</strong> {{ error }}</li>
                    {% endfor %}
                {% endfor %}
            </ul>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    {% endif %}
    
    <div class="row">
        <div class="col-md-6">
            <div class="mb-3">
                <label class="form-label">{{ form.first_name.label }}</label>
                {{ form.first_name }}
                {% for error in form.first_name.errors %}
                    <small class="text-danger">{{ error }}</small>
                {% endfor %}
            </div>
        </div>
        <div class="col-md-6">
            <div class="mb-3">
                <label class="form-label">{{ form.last_name.label }}</label>
                {{ form.last_name }}
                {% for error in form.last_name.errors %}
                    <small class="text-danger">{{ error }}</small>
                {% endfor %}
            </div>
        </div>
    </div>

    <div class="mb-3">
        <label class="form-label">{{ form.username.label }}</label>
        {{ form.username }}
        {% if form.username.errors and form.username.help_text %}
            <small class="text-muted d-block">{{ form.username.help_text|safe }}</small>
        {% endif %}
        {% for error in form.username.errors %}
            <small class="text-danger">{{ error }}</small>
        {% endfor %}
    </div>

    <div class="mb-3">
        <label class="form-label">{{ form.email.label }}</label>
        {{ form.email }}
        {% for error in form.email.errors %}
            <small class="text-danger">{{ error }}</small>
        {% endfor %}
    </div>

    <div class="mb-3">
        <label class="form-label">{{ form.role.label }}</label>
        {{ form.role }}
        {% for error in form.role.errors %}
            <small class="text-danger">{{ error }}</small>
        {% endfor %}
    </div>

    <div class="mb-3">
        <label class="form-label">{{ form.password1.label }}</label>
        {{ form.password1 }}
        {% if form.password1.errors and form.password1.help_text %}
            <small class="text-muted d-block">{{ form.password1.help_text|safe }}</small>
        {% endif %}
        {% for error in form.password1.errors %}
            <small class="text-danger">{{ error }}</small>
        {% endfor %}
    </div>

    <div class="mb-3" id="confirmPasswordContainer" style="display: none;">
        <label class="form-label">{{ form.password2.label }}</label>
        {{ form.password2 }}
        {% if form.password2.errors and form.password2.help_text %}
            <small class="text-muted d-block">{{ form.password2.help_text|safe }}</small>
        {% endif %}
        {% for error in form.password2.errors %}
            <small class="text-danger">{{ error }}</small>
        {% endfor %}
    </div>

    <div class="d-grid mt-4">
        <button type="submit" class="btn btn-primary">Register</button>
    </div>
</form>
